create DATABASE QL_STORE
USE QL_STORE
CREATE TABLE KHACHHANG (
    MAKH INT,
    HOTEN NVARCHAR(50) NOT NULL,
    NGAYSINH DATE,
    GIOITINH NVARCHAR(50),
    DIENTHOAI NVARCHAR(50),
    TAIKHOAN NVARCHAR(50) UNIQUE,
    MATKHAU NVARCHAR(50) NOT NULL,
    EMAIL NVARCHAR(50),
    DIACHI NVARCHAR(50),
    PRIMARY KEY (MAKH)
);

CREATE TABLE TACGIA (
    MATACGIA INT,
    TENTACGIA NVARCHAR(50) NOT NULL,
    DIACHI NVARCHAR(50),
    TIEUSU NVARCHAR(50),
    DIENTHOAI NVARCHAR(50),
    PRIMARY KEY (MATACGIA)
);

CREATE TABLE NHAXUATBAN (
    MANXB INT,
    TENNXB NVARCHAR(50) NOT NULL,
    DIACHI NVARCHAR(50),
    DIENTHOAI NVARCHAR(50),
    PRIMARY KEY (MANXB)
);

CREATE TABLE CHUDE (
    MACHUDE INT,
    TENCHUDE NVARCHAR(50) NOT NULL,
    PRIMARY KEY (MACHUDE)
);

CREATE TABLE SACH (
    MASACH INT,
    TENSACH NVARCHAR(50) NOT NULL,
    GIABAN MONEY,
    MOTA NVARCHAR(50),
    NGAYCAPNHAT DATE,
    ANHBIA NVARCHAR(50),
    SOLUONGTON INT,
    MOI BIT,
    MACHUDE INT,
    MANXB INT,
    PRIMARY KEY (MASACH)
);

CREATE TABLE DONHANG (
    MADONHANG INT,
    NGAYGIAO DATE,
    NGAYDAT DATE,
    DATHANHTOAN BIT,
    TINHTRANGGIAOHANG NVARCHAR(50),
    MAKH INT,
    PRIMARY KEY (MADONHANG)
);

CREATE TABLE CHITIETDONHANG (
    MADONHANG INT,
    MASACH INT,
    SOLUONG INT,
    DONGIA MONEY,
    PRIMARY KEY (MADONHANG, MASACH)
);

CREATE TABLE THAMGIA (
    MASACH INT,
    MATACGIA INT,
    VAITRO NVARCHAR(50),
    VITRI NVARCHAR(50),
    PRIMARY KEY (MASACH, MATACGIA)
);

-- KHÓA NGOẠI CHO BẢNG SACH
ALTER TABLE SACH 
ADD FOREIGN KEY (MACHUDE) REFERENCES CHUDE(MACHUDE);

ALTER TABLE SACH 
ADD FOREIGN KEY (MANXB) REFERENCES NHAXUATBAN(MANXB);

-- KHÓA NGOẠI CHO BẢNG DONHANG
ALTER TABLE DONHANG 
ADD FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH);

-- KHÓA NGOẠI CHO BẢNG CHITIETDONHANG
ALTER TABLE CHITIETDONHANG 
ADD FOREIGN KEY (MADONHANG) REFERENCES DONHANG(MADONHANG);

ALTER TABLE CHITIETDONHANG 
ADD FOREIGN KEY (MASACH) REFERENCES SACH(MASACH);

-- KHÓA NGOẠI CHO BẢNG THAMGIA
ALTER TABLE THAMGIA 
ADD FOREIGN KEY (MASACH) REFERENCES SACH(MASACH);

ALTER TABLE THAMGIA 
ADD FOREIGN KEY (MATACGIA) REFERENCES TACGIA(MATACGIA);

INSERT INTO KHACHHANG (MAKH, HOTEN, NGAYSINH, GIOITINH, DIENTHOAI, TAIKHOAN, MATKHAU, EMAIL, DIACHI)
VALUES (1, 'NGUYEN VAN A', '2000-01-15', 'NAM', '0909123456', 'NVA', 'PASS123', 'NVA@EMAIL.COM', '123 LE LOI, Q1');

INSERT INTO KHACHHANG (MAKH, HOTEN, NGAYSINH, GIOITINH, DIENTHOAI, TAIKHOAN, MATKHAU, EMAIL, DIACHI)
VALUES (2, 'TRAN THI B', '1995-10-20', 'NU', '0912654321', 'TTB', 'PASS456', 'TTB@EMAIL.COM', '456 HAI BA TRUNG, Q3');

INSERT INTO KHACHHANG (MAKH, HOTEN, NGAYSINH, GIOITINH, DIENTHOAI, TAIKHOAN, MATKHAU, EMAIL, DIACHI)
VALUES (3, 'LE VAN C', '2002-03-05', 'NAM', '0987111222', 'LVC', 'PASS789', 'LVC@EMAIL.COM', '789 NGUYEN TRAI, Q5');

INSERT INTO TACGIA (MATACGIA, TENTACGIA, DIACHI, TIEUSU, DIENTHOAI)
VALUES (10, 'TRAN VAN DU', 'HA NOI', 'TAC GIA NOI TIENG', '0911111111');

INSERT INTO TACGIA (MATACGIA, TENTACGIA, DIACHI, TIEUSU, DIENTHOAI)
VALUES (20, 'LE THI E', 'DA NANG', 'CHUYEN GIA TAM LY', '0922222222');

INSERT INTO TACGIA (MATACGIA, TENTACGIA, DIACHI, TIEUSU, DIENTHOAI)
VALUES (30, 'PHAM VAN F', 'TP. HCM', 'GS. CNTT', '0933333333');

INSERT INTO NHAXUATBAN (MANXB, TENNXB, DIACHI, DIENTHOAI)
VALUES (100, 'NXB GIAO DUC', 'HA NOI', '024111222');

INSERT INTO NHAXUATBAN (MANXB, TENNXB, DIACHI, DIENTHOAI)
VALUES (200, 'NXB TRE', 'TP. HCM', '028333444');

INSERT INTO CHUDE (MACHUDE, TENCHUDE)
VALUES (1000, 'VAN HOC');

INSERT INTO CHUDE (MACHUDE, TENCHUDE)
VALUES (2000, 'KHOA HOC');

INSERT INTO CHUDE (MACHUDE, TENCHUDE)
VALUES (3000, 'TAM LY');

INSERT INTO SACH (MASACH, TENSACH, GIABAN, MOTA, NGAYCAPNHAT, ANHBIA, SOLUONGTON, MOI, MACHUDE, MANXB)
VALUES (101, 'DAC NHAN TAM', 150000, 'SACH BAN CHAY', '2023-01-01', '/IMG/S101.JPG', 100, 1, 3000, 200);

INSERT INTO SACH (MASACH, TENSACH, GIABAN, MOTA, NGAYCAPNHAT, ANHBIA, SOLUONGTON, MOI, MACHUDE, MANXB)
VALUES (102, 'LAP TRINH C#', 250000, 'SACH CHO LAP TRINH VIEN', '2023-05-10', '/IMG/S102.JPG', 50, 1, 2000, 100);

INSERT INTO SACH (MASACH, TENSACH, GIABAN, MOTA, NGAYCAPNHAT, ANHBIA, SOLUONGTON, MOI, MACHUDE, MANXB)
VALUES (103, 'CHI PHEO', 80000, 'TRUYEN NGAN', '2022-11-20', '/IMG/S103.JPG', 200, 0, 1000, 200);

INSERT INTO SACH (MASACH, TENSACH, GIABAN, MOTA, NGAYCAPNHAT, ANHBIA, SOLUONGTON, MOI, MACHUDE, MANXB)
VALUES (104, 'VAT LY DAI CUONG', 120000, 'SACH GIAO KHOA', '2023-08-15', '/IMG/S104.JPG', 150, 0, 2000, 100);

INSERT INTO DONHANG (MADONHANG, NGAYGIAO, NGAYDAT, DATHANHTOAN, TINHTRANGGIAOHANG, MAKH)
VALUES (1, '2025-11-05', '2025-11-01', 1, 'DANG GIAO', 1);

INSERT INTO DONHANG (MADONHANG, NGAYGIAO, NGAYDAT, DATHANHTOAN, TINHTRANGGIAOHANG, MAKH)
VALUES (2, '2025-11-03', '2025-11-02', 0, 'DA NHAN', 2);

INSERT INTO DONHANG (MADONhang, NGAYGIAO, NGAYDAT, DATHANHTOAN, TINHTRANGGIAOHANG, MAKH)
VALUES (3, '2025-11-04', '2025-11-03', 1, 'DA GIAO', 1);

INSERT INTO THAMGIA (MASACH, MATACGIA, VAITRO, VITRI)
VALUES (101, 20, 'TAC GIA CHINH', 'BIA SACH');

INSERT INTO THAMGIA (MASACH, MATACGIA, VAITRO, VITRI)
VALUES (102, 30, 'TAC GIA CHINH', 'BIA SACH');

INSERT INTO THAMGIA (MASACH, MATACGIA, VAITRO, VITRI)
VALUES (103, 10, 'TAC GIA CHINH', 'BIA SACH');

INSERT INTO THAMGIA (MASACH, MATACGIA, VAITRO, VITRI)
VALUES (104, 30, 'DONG TAC GIA', 'CHUONG 1');

INSERT INTO THAMGIA (MASACH, MATACGIA, VAITRO, VITRI)
VALUES (104, 10, 'DONG TAC GIA', 'CHUONG 2');

INSERT INTO CHITIETDONHANG (MADONHANG, MASACH, SOLUONG, DONGIA)
VALUES (1, 101, 1, 150000);

INSERT INTO CHITIETDONHANG (MADONHANG, MASACH, SOLUONG, DONGIA)
VALUES (1, 102, 2, 250000);

INSERT INTO CHITIETDONHANG (MADONHANG, MASACH, SOLUONG, DONGIA)
VALUES (2, 103, 1, 80000);

INSERT INTO CHITIETDONHANG (MADONHANG, MASACH, SOLUONG, DONGIA)
VALUES (3, 104, 1, 120000);

INSERT INTO CHITIETDONHANG (MADONHANG, MASACH, SOLUONG, DONGIA)
VALUES (3, 101, 1, 150000);

UPDATE SACH
SET ANHBIA = 'S101.JPG'
WHERE MASACH = 101;

UPDATE SACH
SET ANHBIA = 'S102.JPG'
WHERE MASACH = 102;

UPDATE SACH
SET ANHBIA = 'S103.JPG'
WHERE MASACH = 103;

UPDATE SACH
SET ANHBIA = 'S104.JPG'
WHERE MASACH = 104;
